<!DOCTYPE html>
<html lang='ja'>
<head>
  <meta charset='utf-8'>
  <title>sample</title>
<style>

.link {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;
}

/*#licensing {
  fill: green;
}

.link.licensing {
  stroke: green;
}
*/

.link.dashed {
  stroke-dasharray: 0,2 1;
}

circle {
  fill: #ccc;
  stroke: #333;
  stroke-width: 1.5px;
}

text {
  font: 10px sans-serif;
  pointer-events: none;
  text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, 0 -1px 0 #fff, -1px 0 0 #fff;
}

</style>
</head>
<body>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js' charset='utf-8'></script>
<script>

// http://blog.thomsonreuters.com/index.php/mobile-patent-solids-graphic-of-the-day/
var links = [
  {source: '01', target: '02', type: 'solid'},
  {source: '01', target: '03', type: 'solid'},
  {source: '04', target: '05', type: 'solid'},
  {source: '06', target: '05', type: 'solid'},
  {source: '07', target: '05', type: 'dashed'},
  {source: '03', target: '05', type: 'solid'},
  {source: '08', target: '05', type: 'solid'},
  {source: '01', target: '09', type: 'solid'},
  {source: '01', target: '10', type: 'solid'},
  {source: '01', target: '12', type: 'solid'},
  {source: '11', target: '12', type: 'solid'},
  {source: '05', target: '03', type: 'solid'},
  {source: '01', target: '13', type: 'solid'},
  {source: '04', target: '08', type: 'dashed'},
  {source: '14', target: '08', type: 'dashed'},
  {source: '15', target: '08', type: 'solid'},
  {source: '16', target: '14', type: 'solid'},
  {source: '08', target: '14', type: 'dashed'},
  {source: '05', target: '07', type: 'dashed'},
  {source: '17', target: '07', type: 'dashed'},
  {source: '05', target: '06', type: 'solid'},
  {source: '01', target: '06', type: 'solid'},
  {source: '06', target: '01', type: 'solid'},
  {source: '18', target: '19', type: 'solid'},
  {source: '20', target: '19', type: 'solid'},
  {source: '08', target: '04', type: 'dashed'},
  {source: '05', target: '04', type: 'solid'},
  {source: '08', target: '15', type: 'solid'},
  {source: '07', target: '17', type: 'solid'}
];

var nodes = {
  '01': {id: '01', name: 'Microsoft', r: 10},
  '02': {id: '02', name: 'Amazon', r: 10},
  '03': {id: '03', name: 'HTC', r: 20},
  '04': {id: '04', name: 'Samsung', r: 20},
  '05': {id: '05', name: 'Apple', r: 60},
  '06': {id: '06', name: 'Motorola', r: 20},
  '07': {id: '07', name: 'Nokia', r: 20},
  '08': {id: '08', name: 'Kodak', r: 30},
  '09': {id: '09', name: 'Barnes & Noble', r: 10},
  '10': {id: '10', name: 'Foxconn', r: 10},
  '11': {id: '11', name: 'Oracle', r: 10},
  '12': {id: '12', name: 'Google', r: 20},
  '13': {id: '13', name: 'Inventec', r: 10},
  '14': {id: '14', name: 'LG', r: 20},
  '15': {id: '15', name: 'RIM', r: 10},
  '16': {id: '16', name: 'Sony', r: 10},
  '17': {id: '17', name: 'Qualcomm', r: 10},
  '18': {id: '18', name: 'Huawei', r: 10},
  '19': {id: '19', name: 'ZTE', r: 20},
  '20': {id: '20', name: 'Ericsson', r: 10},
  '21': {id: '21', name: 'TEST', r: 10},
};

// Compute the distinct nodes from the links.
 links.forEach(function(link) {
   link.source = nodes[link.source];
   link.target = nodes[link.target];
 });

var width = 960,
    height = 500;

var force = d3.layout.force()
    .size([width, height])
    .nodes(d3.values(nodes))
      .charge(function(n) {return -(n.r + 300);})
    .links(links)
    .linkDistance(function(l) { return l.target.r + l.source.r + 50;})
    .on('tick', tick)
    .start();

var svg = d3.select('body').append('svg')
    .attr('width', width)
    .attr('height', height);

// Per-type markers, as they don't inherit styles.
svg.append('defs').selectAll('marker')
    //.data(['solid', 'dashed'])
    .data(force.nodes())
  .enter().append('marker')
    .attr('id', function(d) { return d.id; })
    .attr('viewBox', '0 -5 10 10')
    .attr('refX', function(d) { return 5 + Math.sqrt(Math.pow(d.r,2) - Math.pow(d.r-10, 1.9));})
    .attr('refY', function(d) { return 0;})
    .attr('markerWidth', 10)
    .attr('markerHeight', 10)
    .attr('orient', 'auto')
  .append('path')
    .attr('d', 'M0,-5L10,0L0,5'); //arrow
    //.attr('d', 'M 0,0 m -5,-5 L 5,-5 L 5,5 L -5,5 Z'); // square

var path = svg.append('g').selectAll('path')
    .data(force.links())
  .enter().append('path')
    .attr('class', function(d) { return 'link ' + d.type; })
    .attr('marker-end', function(d) { return 'url(#' + d.target.id + ')'; });

var circle = svg.append('g').selectAll('circle')
    .data(force.nodes())
  .enter().append('circle')
    .attr('r', function(d) { return d.r; })
    .call(force.drag);

var text = svg.append('g').selectAll('text')
    .data(force.nodes())
  .enter().append('text')
    //.attr('x', function(d) { return -(d.name.length / 2 * 6); })
    .attr('text-anchor', 'middle')
    .attr('y', '.31em')
    .text(function(d) { return d.name; });

// Use elliptical arc path segments to doubly-encode directionality.
function tick() {
  path.attr('d', linkArc);
  circle.attr('transform', transform);
  text.attr('transform', transform);
}

function linkArc(d) {
  var dx = d.target.x - d.source.x;
  var dy = d.target.y - d.source.y;
  var dr = Math.sqrt(dx * dx + dy * dy);
  return 'M' + d.source.x + ',' + d.source.y + 'A' + 0 + ',' + dr + ' 0 0,1 ' + d.target.x + ',' + d.target.y;
}

function transform(d) {
  return 'translate(' + d.x + ',' + d.y + ')';
}

</script>
</body>
</html>

